<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:filter="http://java.sun.com/jsf/composite/components/filter"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<composite:interface>
	<composite:attribute name="bean" required="true" />
</composite:interface>

<composite:implementation>

	<p:dialog id="configuracoesTabela" widgetVar="confTableConteudo"
		styleClass="dialogConfiguracoes" modal="true">

		<p:dataTable id="configuracaoTable" draggableRows="true"
			selection="#{cc.attrs.bean.configuracaoPerfil}"
			value="#{cc.attrs.bean.colunasPagina}" var="coluna"
			rowKey="#{coluna.id.coluna}" styleClass="dataTableConfiguracaoTabela">

       		<p:ajax event="rowReorder" listener="#{cc.attrs.bean.reordenarLinha}" update=":conteudoForm:modelTable:conteudoTable" />


			<p:column selectionMode="multiple"
				style="width:16px;text-align:center" />

			<p:column headerText="#{managerBean.get('label.coluna')}"
				styleClass="colunaDataTableColunas">
				<h:outputLabel styleClass="textoTableColunaConfiguracaoLabel"
					value="#{managerBean.get(cc.attrs.bean.getLabelFilter(coluna.id.coluna))}" />
			</p:column>
			<p:column headerText="#{managerBean.get('label.parametros.filtro')}"
				styleClass="colunaDataTableSelectOneMenu">
				<filter:selectTipoFiltro
					filtro="#{cc.attrs.bean.getFilter(coluna.id.coluna)}" />
			</p:column>

			<f:facet name="footer">
				<p:commandButton id="botaoSalvarConf" styleClass="btnSalvarConf"
					value="#{managerBean.get('label.salvar')}"
					actionListener="#{cc.attrs.bean.salvarPerfilPagina()}"
					process="@parent" update=":conteudoForm:modelTable:conteudoTable"
					onsuccess="PF('confTableConteudo').hide()" />
			</f:facet>

		</p:dataTable>
	</p:dialog>

	<p:dataTable id="conteudoTable" var="list" 
		selection="#{cc.attrs.bean.registro}"
		value="#{cc.attrs.bean.conteudo}" selectionMode="single"
		rowKey="#{list.id}" styleClass="tableCadastros" rows="15"
		paginator="true" widgetVar="table"
		filteredValue="#{cc.attrs.bean.filtrados}"
		emptyMessage="#{managerBean.get('msg.nao.ha.registros')}"
		paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">

		<f:facet name="header">
			<p:commandButton value="#{managerBean.get('label.configuracoes')}"
				onclick="PF('confTableConteudo').show()" />
		</f:facet>

		<p:ajax event="rowSelect" update="conteudoTable" />
		<p:ajax event="rowUnselect" update="conteudoTable" />

		<p:column id="seletor" selectionMode="single"
			style="width:16px;text-align:center" />

		<p:columns value="#{cc.attrs.bean.configuracaoPerfil}"
			styleClass="colunasStyle" var="coluna" id="columns"
			columnIndexVar="colIndex">
			<f:facet name="header">
				<filter:number id="componentFilterNumberId"
					update=":conteudoForm:modelTable:conteudoTable"
					rendered="#{cc.attrs.bean.getFilter(coluna.id.coluna).genericType.simpleName.equals('Long')}"
					widgetAnotado="#{coluna.id.coluna}" bean="#{cc.attrs.bean}"
					styleClassBotaoLimpar="limpar" styleClassFiltroDois="filtroFinal"
					styleClassFiltroUm="filtroInicial"
					styleClassTitulo="tituloColunaFiltro" />
				<filter:string id="componentFilterStringId"
					update=":conteudoForm:modelTable:conteudoTable"
					rendered="#{cc.attrs.bean.getFilter(coluna.id.coluna).genericType.simpleName.equals('String')}"
					widgetAnotado="#{coluna.id.coluna}" bean="#{cc.attrs.bean}"
					styleClassBotaoLimpar="limpar" styleClassFiltroUm="filtroInicial"
					styleClassTitulo="tituloColunaFiltro" />
				<filter:date id="componentFilterDateId"
					update=":conteudoForm:modelTable:conteudoTable"
					rendered="#{cc.attrs.bean.getFilter(coluna.id.coluna).genericType.simpleName.equals('Calendar')}"
					widgetAnotado="#{coluna.id.coluna}" bean="#{cc.attrs.bean}"
					styleClassBotaoLimpar="limpar" styleClassFiltroDois="filtroFinal"
					styleClassFiltroUm="filtroInicial"
					styleClassTitulo="tituloColunaFiltro" />
			</f:facet>

			<h:outputText
				rendered="#{cc.attrs.bean.getFilter(coluna.id.coluna).genericType.simpleName.equals('Calendar')}"
				value="#{cc.attrs.bean.obterLabelColuna(coluna,list)}">
				<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />
			</h:outputText>

			<h:outputText
				rendered="#{!cc.attrs.bean.getFilter(coluna.id.coluna).genericType.simpleName.equals('Calendar')}"
				value="#{cc.attrs.bean.obterLabelColuna(coluna,list)}">
			</h:outputText>

		</p:columns>

	</p:dataTable>

</composite:implementation>

</html>